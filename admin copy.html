<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Site Admin - Quản lý website cưới</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Admin Styles -->
    <link href="./admin/css/admin-styles.css" rel="stylesheet">
    <link href="./admin/css/admin-enhanced.css" rel="stylesheet">
    
    <style>
        .banner-preview {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
            min-height: 200px;
        }
        
        .main-banner-preview {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .banner-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
        }
        
        .thumbnail-preview {
            position: relative;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .thumbnail-preview:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .thumbnail-preview.active {
            border: 2px solid #007bff;
        }
        
        .thumbnail-overlay {
            position: absolute;
            top: 5px;
            right: 5px;
        }
        
        .banner-info {
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .banner-stats {
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        /* Professional Preview Styles */
        .preview-container {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .preview-main {
            position: relative;
            height: 400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .preview-slideshow {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .preview-slides {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .preview-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        .preview-slide.active {
            opacity: 1;
        }
        
        .preview-image-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .preview-main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .preview-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }
        
        .preview-content {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .preview-title {
            font-size: 1.5rem;
            font-weight: 300;
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }
        
        .preview-names {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .preview-date {
            font-size: 1.2rem;
            font-weight: 300;
            opacity: 0.9;
        }
        
        .preview-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 3;
        }
        
        .preview-badge .badge {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        .preview-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            z-index: 3;
        }
        
        .preview-control-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .preview-control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        
        .preview-info {
            padding: 24px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .info-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .info-header h5 {
            color: #495057;
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        .info-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-item label {
            font-weight: 500;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .info-item span {
            color: #495057;
            font-weight: 500;
        }
        
        .preview-gallery {
            padding: 24px;
        }
        
        /* Story Management Styles */
        .stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .story-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        
        .story-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .story-card.dragging {
            opacity: 0.7;
            transform: rotate(5deg);
        }
        
        .story-image {
            width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: contain;
            object-position: center;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .story-content {
            padding: 20px;
        }
        
        .story-milestone {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .story-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            line-height: 1.3;
        }
        
        .story-description {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .story-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .story-card:hover .story-actions {
            opacity: 1;
        }
        
        .story-action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .story-action-btn.edit {
            background: #007bff;
            color: white;
        }
        
        .story-action-btn.delete {
            background: #dc3545;
            color: white;
        }
        
        .story-action-btn.visibility {
            background: #28a745;
            color: white;
        }
        
        .story-action-btn:hover {
            transform: scale(1.1);
        }
        
        .story-status {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .story-status.visible {
            background: #d4edda;
            color: #155724;
        }
        
        .story-status.hidden {
            background: #f8d7da;
            color: #721c24;
        }
        
        .story-form-container {
            margin-bottom: 30px;
        }
        
        .story-form-container .card {
            border: none;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .story-form-container .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        
        .story-form-container .btn-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .story-form-container .btn-close:hover {
            opacity: 1;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .empty-stories {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-stories i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-stories h5 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .drag-handle {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 20px;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .story-card:hover .drag-handle {
            opacity: 1;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .drag-handle::before {
            content: "⋮⋮";
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .gallery-header h5 {
            color: #495057;
            margin: 0;
            font-weight: 600;
        }
        
        .gallery-count {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }
        
        .gallery-item {
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .gallery-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .gallery-item.active {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,123,255,0.3);
        }
        
        .gallery-image {
            position: relative;
            aspect-ratio: 4/3;
            overflow: hidden;
        }
        
        .gallery-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .gallery-item:hover .gallery-image img {
            transform: scale(1.05);
        }
        
        .gallery-overlay {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .gallery-info {
            padding: 12px;
            background: white;
        }
        
        .gallery-title {
            font-size: 0.85rem;
            color: #495057;
            font-weight: 500;
            display: block;
            text-align: center;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: #f8f9fa;
            border-radius: 16px;
            border: 2px dashed #dee2e6;
        }
        
        .empty-icon {
            font-size: 4rem;
            color: #adb5bd;
            margin-bottom: 20px;
        }
        
        .empty-state h4 {
            color: #495057;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .empty-state p {
            color: #6c757d;
            margin-bottom: 24px;
            font-size: 1.1rem;
        }
        
        .empty-state .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
        }
        
    </style>

</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Đang xử lý...</p>
        </div>
    </div>

    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <h1><i class="fas fa-heart me-2"></i>Wedding Site Admin</h1>
            <p>Quản lý website cưới chuyên nghiệp</p>
        </div>

        <!-- Navigation -->
        <ul class="nav nav-pills admin-nav" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview" type="button" role="tab">
                    <i class="fas fa-tachometer-alt me-2"></i>Tổng quan
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="hero-tab" data-bs-toggle="pill" data-bs-target="#hero" type="button" role="tab">
                    <i class="fas fa-star me-2"></i>Trang chủ
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="couple-tab" data-bs-toggle="pill" data-bs-target="#couple" type="button" role="tab">
                    <i class="fas fa-users me-2"></i>Cặp đôi
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="story-tab" data-bs-toggle="pill" data-bs-target="#story" type="button" role="tab">
                    <i class="fas fa-book me-2"></i>Câu chuyện
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="gallery-tab" data-bs-toggle="pill" data-bs-target="#gallery" type="button" role="tab">
                    <i class="fas fa-images me-2"></i>Thư viện ảnh
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="payment-tab" data-bs-toggle="pill" data-bs-target="#payment" type="button" role="tab">
                    <i class="fas fa-credit-card me-2"></i>Chuyển khoản
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="event-tab" data-bs-toggle="pill" data-bs-target="#event" type="button" role="tab">
                    <i class="fas fa-calendar-alt me-2"></i>Sự kiện
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="wishes-tab" data-bs-toggle="pill" data-bs-target="#wishes" type="button" role="tab">
                    <i class="fas fa-heart me-2"></i>Lời chúc
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="theme-tab" data-bs-toggle="pill" data-bs-target="#theme" type="button" role="tab">
                    <i class="fas fa-palette me-2"></i>Giao diện
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="layout-tab" data-bs-toggle="pill" data-bs-target="#layout" type="button" role="tab">
                    <i class="fas fa-th-large me-2"></i>Bố cục
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="pill" data-bs-target="#settings" type="button" role="tab">
                    <i class="fas fa-cog me-2"></i>Cài đặt
                </button>
            </li>
        </ul>

        <!-- Content -->
        <div class="tab-content admin-content" id="adminTabContent">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <div class="section-card">
                            <div class="section-header">
                                <h5><i class="fas fa-chart-line me-2"></i>Thống kê nhanh</h5>
                            </div>
                            <div class="section-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h3 text-primary mb-1" id="totalImages">0</div>
                                            <div class="text-muted">Hình ảnh</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h3 text-success mb-1" id="totalStories">0</div>
                                            <div class="text-muted">Câu chuyện</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h3 text-warning mb-1" id="totalSections">0</div>
                                            <div class="text-muted">Phần nội dung</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h3 text-info mb-1" id="lastUpdated">Chưa cập nhật</div>
                                            <div class="text-muted">Lần cuối</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="section-card">
                            <div class="section-header">
                                <h5><i class="fas fa-eye me-2"></i>Xem trước website</h5>
                            </div>
                            <div class="section-body">
                                <p class="text-muted mb-3">Nhấn nút bên dưới để xem trước website với các thay đổi hiện tại.</p>
                                <button class="btn btn-custom" onclick="previewWebsite()">
                                    <i class="fas fa-external-link-alt me-2"></i>Xem trước website
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="section-card">
                            <div class="section-header">
                                <h5><i class="fas fa-save me-2"></i>Lưu trữ & Xuất</h5>
                            </div>
                            <div class="section-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" onclick="saveSiteData()">
                                        <i class="fas fa-save me-2"></i>Lưu thay đổi
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="downloadData()">
                                        <i class="fas fa-download me-2"></i>Tải file JSON
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="loadData()">
                                        <i class="fas fa-upload me-2"></i>Nhập file JSON
                                    </button>
                                    <button class="btn btn-outline-info" onclick="exportUploadedFiles()">
                                        <i class="fas fa-file-export me-2"></i>Xuất file ảnh
                                    </button>
                                    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileUpload(this)">
                                </div>
                            </div>
                        </div>

                        <div class="section-card">
                            <div class="section-header">
                                <h5><i class="fas fa-info-circle me-2"></i>Hướng dẫn nhanh</h5>
                            </div>
                            <div class="section-body">
                                <div class="alert alert-info">
                                    <small>
                                        <strong>💡 Mẹo:</strong><br>
                                        • Kéo thả để sắp xếp nội dung<br>
                                        • Click vào ảnh để thay đổi<br>
                                        • Sử dụng nút "Xem trước" để kiểm tra<br>
                                        • Nhớ lưu thay đổi trước khi đóng
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hero Tab -->
            <div class="tab-pane fade" id="hero" role="tabpanel">
                <!-- Basic Info Section -->
                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-star me-2"></i>Thông tin cơ bản</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Tên chú rể</label>
                                    <input type="text" class="form-control" id="groomName" placeholder="Nhập tên chú rể">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tên cô dâu</label>
                                    <input type="text" class="form-control" id="brideName" placeholder="Nhập tên cô dâu">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ngày cưới</label>
                                    <input type="date" class="form-control" id="weddingDate">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Giờ cưới</label>
                                    <input type="time" class="form-control" id="weddingTime" placeholder="HH:MM">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Địa điểm</label>
                                    <input type="text" class="form-control" id="weddingLocation" placeholder="Nhập địa điểm tổ chức">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tiêu đề website</label>
                                    <input type="text" class="form-control" id="mainTitle" placeholder="Nhập tiêu đề chính">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Mô tả ngắn</label>
                                    <textarea class="form-control" id="description" rows="3" placeholder="Nhập mô tả ngắn về website"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Màu chủ đạo</label>
                                    <input type="color" class="form-control" id="primaryColor" value="#9f5958">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Banner Images Management -->
                <div class="section-card">
                    <div class="section-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-images me-2"></i>Quản lý ảnh banner</h5>
                        <div class="btn-group">
                            <button class="btn btn-outline-secondary btn-sm" onclick="reloadBannerData()" title="Tải lại dữ liệu từ server">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="clearBannerSlides()" title="Xóa tất cả ảnh banner">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-custom btn-sm" onclick="addBannerSlide()">
                                <i class="fas fa-plus me-2"></i>Thêm ảnh banner
                            </button>
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Hướng dẫn:</strong> Click vào nút "Thêm ảnh banner" để thêm banner mới. Click vào ảnh để thay đổi ảnh banner hiện có.
                        </div>

                        <!-- Banner Slides List -->
                        <div id="bannerSlidesList">
                            <!-- Banner slides will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Banner Preview -->
                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-eye me-2"></i>Xem trước banner</h5>
                    </div>
                    <div class="section-body">
                        <div class="banner-preview-container">
                            <div id="bannerPreview" class="banner-preview">
                                <!-- Banner preview will be loaded here -->
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshPreview()">
                                <i class="fas fa-sync me-2"></i>Làm mới xem trước
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Couple Tab -->
            <div class="tab-pane fade" id="couple" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="section-card">
                            <div class="section-header">
                                <h5><i class="fas fa-male me-2"></i>Thông tin chú rể</h5>
                            </div>
                            <div class="section-body">
                                <div class="form-group">
                                    <label class="form-label">Tên chú rể</label>
                                    <input type="text" class="form-control" id="groomNameDetail" placeholder="Nhập tên chú rể">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Mô tả về chú rể</label>
                                    <textarea class="form-control" id="groomDescription" rows="4" placeholder="Nhập mô tả về chú rể"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cha chú rể</label>
                                    <input type="text" class="form-control" id="groomFather" placeholder="Nhập tên cha chú rể">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Mẹ chú rể</label>
                                    <input type="text" class="form-control" id="groomMother" placeholder="Nhập tên mẹ chú rể">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="section-card">
                            <div class="section-header">
                                <h5><i class="fas fa-female me-2"></i>Thông tin cô dâu</h5>
                            </div>
                            <div class="section-body">
                                <div class="form-group">
                                    <label class="form-label">Tên cô dâu</label>
                                    <input type="text" class="form-control" id="brideNameDetail" placeholder="Nhập tên cô dâu">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Mô tả về cô dâu</label>
                                    <textarea class="form-control" id="brideDescription" rows="4" placeholder="Nhập mô tả về cô dâu"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cha cô dâu</label>
                                    <input type="text" class="form-control" id="brideFather" placeholder="Nhập tên cha cô dâu">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Mẹ cô dâu</label>
                                    <input type="text" class="form-control" id="brideMother" placeholder="Nhập tên mẹ cô dâu">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Couple Detail Images Management -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="section-card">
                            <div class="section-header">
                                <h5><i class="fas fa-image me-2"></i>Ảnh chi tiết The Groom</h5>
                            </div>
                            <div class="section-body">
                                <div class="form-group">
                                    <label class="form-label">Ảnh chính The Groom</label>
                                    <div class="image-upload-area" data-upload-type="groom" onclick="selectCoupleImage('groom')">
                                        <div class="upload-placeholder">
                                            <i class="fas fa-user fa-3x mb-3"></i>
                                            <p>Nhấn để tải ảnh The Groom</p>
                                        </div>
                                        <img id="groom-image-preview" class="uploaded-image" style="display: none; width: 100%; height: auto; aspect-ratio: 1/1; object-fit: cover; border-radius: 12px; box-shadow: inset 0 0 0 15px #fff;">
                                    </div>
                                    <small class="form-text text-muted">Ảnh này sẽ hiển thị trong phần "The Groom" trên website</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="section-card">
                            <div class="section-header">
                                <h5><i class="fas fa-image me-2"></i>Ảnh chi tiết The Bride</h5>
                            </div>
                            <div class="section-body">
                                <div class="form-group">
                                    <label class="form-label">Ảnh chính The Bride</label>
                                    <div class="image-upload-area" data-upload-type="bride" onclick="selectCoupleImage('bride')">
                                        <div class="upload-placeholder">
                                            <i class="fas fa-user fa-3x mb-3"></i>
                                            <p>Nhấn để tải ảnh The Bride</p>
                                        </div>
                                        <img id="bride-image-preview" class="uploaded-image" style="display: none; width: 100%; height: auto; aspect-ratio: 1/1; object-fit: cover; border-radius: 12px; box-shadow: inset 0 0 0 15px #fff;">
                                    </div>
                                    <small class="form-text text-muted">Ảnh này sẽ hiển thị trong phần "The Bride" trên website</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Story Tab -->
            <div class="tab-pane fade" id="story" role="tabpanel">
                <div class="section-card">
                    <div class="section-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-book me-2"></i>Quản lý câu chuyện</h5>
                        <button class="btn btn-custom btn-sm" onclick="addStory()">
                            <i class="fas fa-plus me-2"></i>Thêm câu chuyện
                        </button>
                    </div>
                    <div class="section-body">
                        <!-- Stories List -->
                        <div id="storiesList">
                            <div class="stories-grid" id="storiesGrid">
                                <!-- Stories will be loaded here dynamically -->
                            </div>
                        </div>
                        
                        <!-- Story Form (Hidden by default) -->
                        <div id="storyForm" class="story-form-container" style="display: none;">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="fas fa-edit me-2"></i>
                                        <span id="storyFormTitle">Thêm câu chuyện mới</span>
                                    </h6>
                                    <button type="button" class="btn-close" onclick="closeStoryForm()"></button>
                                </div>
                                <div class="card-body">
                                    <form id="storyFormElement" onsubmit="handleStorySubmit(event)">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label class="form-label">Mốc sự kiện</label>
                                                    <input type="text" class="form-control" id="storyMilestone" 
                                                           placeholder="Ví dụ: Ngày gặp nhau lần đầu" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label class="form-label">Tiêu đề</label>
                                                    <input type="text" class="form-control" id="storyTitle" 
                                                           placeholder="Ví dụ: 💕 Lần đầu gặp mặt" required>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group mb-3">
                                            <label class="form-label">Ảnh minh họa</label>
                                            <div class="image-upload-area" data-upload-type="story" onclick="uploadStoryImage()">
                                                <input type="file" id="storyImageInput" accept="image/*" style="display: none;" onchange="handleStoryImageSelect(event)">
                                                <div class="upload-placeholder">
                                                    <i class="fas fa-image fa-3x mb-3"></i>
                                                    <p>Nhấn để chọn ảnh</p>
                                                    <small class="text-muted">JPG, PNG, WebP (Tối đa 5MB)</small>
                                                </div>
                                                <img id="storyImagePreview" class="uploaded-image" style="display: none; width: 100%; height: auto; max-height: 250px; object-fit: contain; object-position: center; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                                <div id="storyImageActions" style="display: none; margin-top: 10px; text-align: center;">
                                                    <button type="button" class="btn btn-sm btn-danger" onclick="removeStoryImage()">
                                                        <i class="fas fa-trash me-1"></i>Xóa ảnh
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group mb-3">
                                            <label class="form-label">Nội dung câu chuyện</label>
                                            <textarea class="form-control" id="storyDescription" rows="6" 
                                                      placeholder="Viết nội dung câu chuyện của bạn..." required></textarea>
                                        </div>
                                        
                                        <div class="form-group mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="storyVisible" checked>
                                                <label class="form-check-label" for="storyVisible">
                                                    Hiển thị trên website
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div class="form-actions">
                                            <button type="button" class="btn btn-secondary" onclick="closeStoryForm()">
                                                <i class="fas fa-times me-2"></i>Hủy
                                            </button>
                                            <button type="button" class="btn btn-custom" onclick="handleStorySubmit(event)">
                                                <i class="fas fa-save me-2"></i>Lưu câu chuyện
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Story Sync Controls -->
                        <div class="story-sync-controls mt-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <button class="btn btn-info btn-sm" onclick="previewOnMainPage()">
                                        <i class="fas fa-eye"></i> Xem trước trên trang chính
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button class="btn btn-warning btn-sm" onclick="forceReloadMainPage()">
                                        <i class="fas fa-sync"></i> Đồng bộ dữ liệu
                                    </button>
                                </div>
                            </div>
                            <div class="alert alert-info mt-3">
                                <i class="fas fa-info-circle"></i>
                                <strong>Hướng dẫn:</strong> Sau khi chỉnh sửa câu chuyện, nhấn "Đồng bộ dữ liệu" và refresh trang index để xem thay đổi.
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>

            <!-- Gallery Tab -->
            <div class="tab-pane fade" id="gallery" role="tabpanel">
                <div class="section-card">
                    <div class="section-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-images me-2"></i>Thư viện ảnh</h5>
                        <button class="btn btn-custom btn-sm" onclick="addGalleryImage()">
                            <i class="fas fa-plus me-2"></i>Thêm ảnh
                        </button>
                    </div>
                    <div class="section-body">
                        <div class="image-upload-area" onclick="uploadMultipleImages()">
                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Click để tải nhiều ảnh hoặc kéo thả vào đây</p>
                            <small class="text-muted">Hỗ trợ JPG, PNG, WebP</small>
                        </div>
                        <div class="row mt-4" id="galleryImages">
                            <!-- Gallery images will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>


            <!-- Payment Tab -->
            <div class="tab-pane fade" id="payment" role="tabpanel">
                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-credit-card me-2"></i>Thông tin chuyển khoản</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Tên ngân hàng</label>
                                    <input type="text" class="form-control" id="bankName" placeholder="Ví dụ: Vietcombank">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Số tài khoản</label>
                                    <input type="text" class="form-control" id="accountNumber" placeholder="Nhập số tài khoản">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="form-label">Tên chủ tài khoản</label>
                                    <input type="text" class="form-control" id="accountHolder" placeholder="Tên người nhận">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">QR Code chung</label>
                                    <div class="image-upload-area" data-upload-type="qr">
                                        <div class="upload-placeholder">
                                            <i class="fas fa-qrcode fa-3x mb-3"></i>
                                            <p>Nhấn để tải QR Code</p>
                                        </div>
                                        <img id="qrCodePreview" class="uploaded-image" style="display: none;">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">QR Code chú rể</label>
                                    <div class="image-upload-area" data-upload-type="groomQR">
                                        <div class="upload-placeholder">
                                            <i class="fas fa-male fa-3x mb-3"></i>
                                            <p>QR Code chú rể</p>
                                        </div>
                                        <img id="groomQRPreview" class="uploaded-image" style="display: none;">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">QR Code cô dâu</label>
                                    <div class="image-upload-area" data-upload-type="brideQR">
                                        <div class="upload-placeholder">
                                            <i class="fas fa-female fa-3x mb-3"></i>
                                            <p>QR Code cô dâu</p>
                                        </div>
                                        <img id="brideQRPreview" class="uploaded-image" style="display: none;">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Lời nhắn cảm ơn</label>
                                    <textarea class="form-control" id="paymentMessage" rows="4" placeholder="Cảm ơn bạn đã gửi lời chúc và quà mừng!"></textarea>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="paymentVisible">
                                    <label class="form-check-label">
                                        Hiển thị thông tin chuyển khoản trên website
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Event Tab -->
            <div class="tab-pane fade" id="event" role="tabpanel">
                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-calendar-alt me-2"></i>Thông tin sự kiện</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Ngày cưới</label>
                                    <input type="date" class="form-control" id="weddingDate">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Giờ lễ cưới</label>
                                    <input type="time" class="form-control" id="weddingTime">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Ngày lễ cưới</label>
                                    <input type="date" class="form-control" id="ceremonyDate">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Giờ lễ cưới</label>
                                    <input type="time" class="form-control" id="ceremonyTime">
                                </div>
                            </div>
                            <div class="col-12">
                                <h6 class="mt-4 mb-3">Lễ cưới</h6>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="form-label">Tên địa điểm lễ cưới</label>
                                    <input type="text" class="form-control" id="ceremonyVenue" placeholder="Nhập tên địa điểm">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="form-label">Địa chỉ lễ cưới</label>
                                    <textarea class="form-control" id="ceremonyAddress" rows="2" placeholder="Nhập địa chỉ chi tiết"></textarea>
                                </div>
                            </div>
                            <div class="col-12">
                                <h6 class="mt-4 mb-3">Tiệc cưới</h6>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Tên địa điểm tiệc</label>
                                    <input type="text" class="form-control" id="receptionVenue" placeholder="Nhập tên địa điểm">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Giờ tiệc</label>
                                    <input type="time" class="form-control" id="receptionTime">
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="form-label">Địa chỉ tiệc cưới</label>
                                    <textarea class="form-control" id="receptionAddress" rows="2" placeholder="Nhập địa chỉ chi tiết"></textarea>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="form-label">Link Google Maps</label>
                                    <input type="url" class="form-control" id="googleMapsLink" placeholder="https://maps.google.com/...">
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="eventVisible">
                                    <label class="form-check-label">
                                        Hiển thị thông tin sự kiện trên website
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wishes Tab -->
            <div class="tab-pane fade" id="wishes" role="tabpanel">
                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-heart me-2"></i>Tùy chỉnh lời chúc</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-12">
                                <div class="form-group">
                                    <label class="form-label">Lời nhắn mặc định</label>
                                    <textarea class="form-control" id="wishesMessage" rows="3" placeholder="Hãy gửi lời chúc của bạn để chia sẻ niềm vui cùng chúng mình!"></textarea>
                                </div>
                            </div>
                            <div class="col-12">
                                <h6 class="mt-3 mb-3">Gợi ý lời chúc</h6>
                                <div id="wishesSuggestions">
                                    <!-- Suggestions will be loaded here -->
                                </div>
                                <button class="btn btn-outline-primary btn-sm mt-2" onclick="addWishSuggestion()">
                                    <i class="fas fa-plus me-1"></i>Thêm gợi ý
                                </button>
                            </div>
                            <div class="col-12">
                                <div class="form-check mt-3">
                                    <input class="form-check-input" type="checkbox" id="wishesVisible">
                                    <label class="form-check-label">
                                        Hiển thị phần lời chúc trên website
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Theme Tab -->
            <div class="tab-pane fade" id="theme" role="tabpanel">
                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-palette me-2"></i>Tùy chỉnh màu sắc</h5>
                    </div>
                    <div class="section-body">
                        <!-- Color Presets -->
                        <div class="form-group mb-4">
                            <label class="form-label">Bộ màu có sẵn</label>
                            <div class="color-presets d-flex flex-wrap gap-2">
                                <div class="color-preset" data-theme="wedding" onclick="applyColorPreset('wedding')">
                                    <div class="preset-colors">
                                        <div class="preset-color" style="background: #9f5958;"></div>
                                        <div class="preset-color" style="background: #f8f9fa;"></div>
                                        <div class="preset-color" style="background: #2c3e50;"></div>
                                    </div>
                                    <small>Wedding Classic</small>
                                </div>
                                <div class="color-preset" data-theme="romantic" onclick="applyColorPreset('romantic')">
                                    <div class="preset-colors">
                                        <div class="preset-color" style="background: #e74c3c;"></div>
                                        <div class="preset-color" style="background: #fdf2f8;"></div>
                                        <div class="preset-color" style="background: #1f2937;"></div>
                                    </div>
                                    <small>Romantic Pink</small>
                                </div>
                                <div class="color-preset" data-theme="elegant" onclick="applyColorPreset('elegant')">
                                    <div class="preset-colors">
                                        <div class="preset-color" style="background: #2c3e50;"></div>
                                        <div class="preset-color" style="background: #ecf0f1;"></div>
                                        <div class="preset-color" style="background: #34495e;"></div>
                                    </div>
                                    <small>Elegant Blue</small>
                                </div>
                                <div class="color-preset" data-theme="golden" onclick="applyColorPreset('golden')">
                                    <div class="preset-colors">
                                        <div class="preset-color" style="background: #f39c12;"></div>
                                        <div class="preset-color" style="background: #fef9e7;"></div>
                                        <div class="preset-color" style="background: #8b4513;"></div>
                                    </div>
                                    <small>Golden Luxury</small>
                                </div>
                                <div class="color-preset" data-theme="forest" onclick="applyColorPreset('forest')">
                                    <div class="preset-colors">
                                        <div class="preset-color" style="background: #27ae60;"></div>
                                        <div class="preset-color" style="background: #eafaf1;"></div>
                                        <div class="preset-color" style="background: #1e8449;"></div>
                                    </div>
                                    <small>Forest Green</small>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-circle text-primary me-1"></i>Màu chủ đạo
                                    </label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control color-picker" id="primaryThemeColor" value="#9f5958">
                                        <input type="text" class="form-control color-text" id="primaryThemeColorText" value="#9f5958" placeholder="#9f5958">
                                    </div>
                                    <small class="form-text text-muted">Màu chính của website</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-circle text-secondary me-1"></i>Màu phụ
                                    </label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control color-picker" id="secondaryThemeColor" value="#f8f9fa">
                                        <input type="text" class="form-control color-text" id="secondaryThemeColorText" value="#f8f9fa" placeholder="#f8f9fa">
                                    </div>
                                    <small class="form-text text-muted">Màu nền và phụ</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-font me-1" style="color: #2c3e50;"></i>Màu văn bản
                                    </label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control color-picker" id="textColor" value="#2c3e50">
                                        <input type="text" class="form-control color-text" id="textColorText" value="#2c3e50" placeholder="#2c3e50">
                                    </div>
                                    <small class="form-text text-muted">Màu chữ chính</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-square me-1" style="color: #ffffff; border: 1px solid #ccc;"></i>Màu nền
                                    </label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control color-picker" id="backgroundColor" value="#ffffff">
                                        <input type="text" class="form-control color-text" id="backgroundColorText" value="#ffffff" placeholder="#ffffff">
                                    </div>
                                    <small class="form-text text-muted">Màu nền chính</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-square me-1" style="color: #dee2e6;"></i>Màu viền
                                    </label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control color-picker" id="borderColor" value="#dee2e6">
                                        <input type="text" class="form-control color-text" id="borderColorText" value="#dee2e6" placeholder="#dee2e6">
                                    </div>
                                    <small class="form-text text-muted">Màu viền và phân cách</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-star me-1" style="color: #e74c3c;"></i>Màu accent
                                    </label>
                                    <div class="color-input-group">
                                        <input type="color" class="form-control color-picker" id="accentColor" value="#e74c3c">
                                        <input type="text" class="form-control color-text" id="accentColorText" value="#e74c3c" placeholder="#e74c3c">
                                    </div>
                                    <small class="form-text text-muted">Màu nhấn và highlight</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-font me-2"></i>Tùy chỉnh font chữ</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Font chính</label>
                                    <select class="form-control" id="primaryFont">
                                        <option value="'Segoe UI', sans-serif">Segoe UI</option>
                                        <option value="'Roboto', sans-serif">Roboto</option>
                                        <option value="'Open Sans', sans-serif">Open Sans</option>
                                        <option value="'Lato', sans-serif">Lato</option>
                                        <option value="'Poppins', sans-serif">Poppins</option>
                                        <option value="'Montserrat', sans-serif">Montserrat</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Font tiêu đề</label>
                                    <select class="form-control" id="headingFont">
                                        <option value="'Playfair Display', serif">Playfair Display</option>
                                        <option value="'Merriweather', serif">Merriweather</option>
                                        <option value="'Lora', serif">Lora</option>
                                        <option value="'Source Serif Pro', serif">Source Serif Pro</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Kích thước font chính</label>
                                    <input type="range" class="form-range" id="baseFontSize" min="12" max="20" value="16">
                                    <small class="form-text text-muted">16px</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Kích thước font tiêu đề</label>
                                    <input type="range" class="form-range" id="headingFontSize" min="24" max="48" value="32">
                                    <small class="form-text text-muted">32px</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-eye me-2"></i>Xem trước theme</h5>
                    </div>
                    <div class="section-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Thay đổi sẽ được áp dụng ngay lập tức. Bạn có thể xem trước trong tab "Xem trước website".
                        </div>
                        <button class="btn btn-custom" onclick="applyTheme()">
                            <i class="fas fa-paint-brush me-2"></i>Áp dụng theme
                        </button>
                        <button class="btn btn-outline-secondary ms-2" onclick="resetTheme()">
                            <i class="fas fa-undo me-2"></i>Khôi phục mặc định
                        </button>
                    </div>
                </div>
            </div>

            <!-- Layout Tab -->
            <div class="tab-pane fade" id="layout" role="tabpanel">
                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-th-large me-2"></i>Bố cục trang chủ</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Kiểu header</label>
                                    <select class="form-control" id="headerStyle">
                                        <option value="hero">Hero Banner</option>
                                        <option value="minimal">Minimal</option>
                                        <option value="classic">Classic</option>
                                        <option value="modern">Modern</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Kiểu navigation</label>
                                    <select class="form-control" id="navStyle">
                                        <option value="top">Top Navigation</option>
                                        <option value="side">Side Navigation</option>
                                        <option value="floating">Floating</option>
                                        <option value="hidden">Hidden</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Kiểu footer</label>
                                    <select class="form-control" id="footerStyle">
                                        <option value="simple">Simple</option>
                                        <option value="detailed">Detailed</option>
                                        <option value="minimal">Minimal</option>
                                        <option value="none">None</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Bố cục nội dung</label>
                                    <select class="form-control" id="contentLayout">
                                        <option value="single">Single Column</option>
                                        <option value="two-column">Two Column</option>
                                        <option value="grid">Grid</option>
                                        <option value="masonry">Masonry</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-cogs me-2"></i>Tùy chỉnh nâng cao</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Khoảng cách giữa các phần</label>
                                    <input type="range" class="form-range" id="sectionSpacing" min="0" max="100" value="50">
                                    <small class="form-text text-muted">50px</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Độ bo góc</label>
                                    <input type="range" class="form-range" id="borderRadius" min="0" max="20" value="8">
                                    <small class="form-text text-muted">8px</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Độ đổ bóng</label>
                                    <input type="range" class="form-range" id="boxShadow" min="0" max="20" value="5">
                                    <small class="form-text text-muted">5px</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Hiệu ứng chuyển động</label>
                                    <select class="form-control" id="animationStyle">
                                        <option value="none">Không có</option>
                                        <option value="fade">Fade</option>
                                        <option value="slide">Slide</option>
                                        <option value="zoom">Zoom</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-mobile-alt me-2"></i>Tối ưu mobile</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="mobileOptimized" checked>
                                    <label class="form-check-label" for="mobileOptimized">
                                        Tối ưu cho mobile
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="touchFriendly" checked>
                                    <label class="form-check-label" for="touchFriendly">
                                        Thân thiện với cảm ứng
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="fastLoading" checked>
                                    <label class="form-check-label" for="fastLoading">
                                        Tải nhanh
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="seoOptimized" checked>
                                    <label class="form-check-label" for="seoOptimized">
                                        Tối ưu SEO
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
                <div class="section-card">
                    <div class="section-header">
                        <h5><i class="fas fa-eye me-2"></i>Hiển thị các phần</h5>
                    </div>
                    <div class="section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="showGallery" checked>
                                    <label class="form-check-label" for="showGallery">
                                        Hiển thị thư viện ảnh
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="showStory" checked>
                                    <label class="form-check-label" for="showStory">
                                        Hiển thị câu chuyện
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="showCouple" checked>
                                    <label class="form-check-label" for="showCouple">
                                        Hiển thị thông tin cặp đôi
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="showRSVP" checked>
                                    <label class="form-check-label" for="showRSVP">
                                        Hiển thị phần xác nhận tham dự
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="showDonate" checked>
                                    <label class="form-check-label" for="showDonate">
                                        Hiển thị phần chúc mừng
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="showAudio" checked>
                                    <label class="form-check-label" for="showAudio">
                                        Phát nhạc nền
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div class="modal fade preview-modal" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-eye me-2"></i>Xem trước website
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <iframe class="preview-frame" src="index.html" id="previewFrame"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Actions -->
    <div class="floating-actions">
        <button class="floating-btn success" onclick="saveSiteData()" title="Lưu thay đổi">
            <i class="fas fa-save"></i>
        </button>
        <button class="floating-btn primary" onclick="previewWebsite()" title="Xem trước">
            <i class="fas fa-eye"></i>
        </button>
        <button class="floating-btn info" onclick="loadDataFromIndex()" title="Tải dữ liệu từ Index">
            <i class="fas fa-sync-alt"></i>
        </button>
        <button class="floating-btn secondary" onclick="scrollToTop()" title="Quay lại đầu trang">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>

    <!-- Embedded site data for fallback -->
    <script>
    window.embeddedSiteData = {
        "meta": {
            "title": "Huy Hùng & Ngọc Trâm",
            "description": "Yêu còn hơn mê. Đó là nhu cầu được cảm thấy toàn bộ, cảm thấy an toàn, được chữa lành, kết hợp với một ai đó, trái tim và linh hồn",
            "primaryColor": "#9f5958",
            "secondaryColor": "#ee8584",
            "accentColor": "#8E9D84"
        },
        "hero": {
            "groomName": "Huy Hùng",
            "brideName": "Ngọc Trâm",
            "weddingDate": "2025-05-03",
            "weddingTime": "11:00",
            "weddingLocation": "Hà Nội, Việt Nam",
            "slides": [
                {
                    "id": "slide-1",
                    "src": "./public/images/banner/1736340563_gallery-04.webp",
                    "visible": true,
                    "title": "Slide 1",
                    "description": "Ảnh banner chính"
                }
            ]
        },
        "couple": {
            "groomName": "Huy Hùng",
            "brideName": "Ngọc Trâm",
            "groomDescription": "Là một người hiền lành nhưng nói nhiều.",
            "brideDescription": "Là một người hay cười nhưng lại sống nội tâm.",
            "visible": true
        },
        "theme": {
            "primaryColor": "#9f5958",
            "secondaryColor": "#f8f9fa",
            "textColor": "#2c3e50",
            "backgroundColor": "#ffffff",
            "borderColor": "#dee2e6",
            "accentColor": "#e74c3c"
        }
    };
    </script>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- SQLite Admin Script -->
    <script>
        console.log('🚀 SQLite Admin Script Started');
        
        let siteData = {};
        let isDataLoaded = false;
        
        // Load data from SQLite API
        async function loadSiteData() {
            console.log('🔄 Loading data from SQLite...');
            
            try {
                const response = await fetch('http://localhost:5001/api/data');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('📦 SQLite API Result:', result);
                
                if (result.success && result.data) {
                    siteData = result.data;
                    isDataLoaded = true;
                    
                    console.log('✅ Data loaded from SQLite:', siteData);
                    
                    // Update admin interface
                    updateAdminInterface();
                    
                    return;
                } else {
                    throw new Error('SQLite API returned unsuccessful response');
                }
            } catch (error) {
                console.error('❌ Error loading data from SQLite:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi tải dữ liệu',
                    text: '❌ Lỗi khi tải dữ liệu: ' + error.message
                });
            }
        }
        
        // Update admin interface with loaded data
        function updateAdminInterface() {
            console.log('🔄 Updating admin interface...');
            
            if (!isDataLoaded) {
                console.log('❌ Data not loaded, skipping interface update');
                return;
            }
            
            console.log('✅ Updating admin interface with data:', siteData);
            
            // Update form fields
            updateFormFields();
        }
        
        // Update form fields with data
        function updateFormFields() {
            console.log('🔄 Updating form fields...');
            
            // Hero section
            if (siteData.hero) {
                console.log('👰 Hero data:', siteData.hero);
                setFieldValue('groomName', siteData.hero.groomName);
                setFieldValue('brideName', siteData.hero.brideName);
                setFieldValue('weddingDate', siteData.hero.weddingDate);
                setFieldValue('weddingLocation', siteData.hero.weddingLocation);
            }
            
            // Meta information
            if (siteData.meta) {
                setFieldValue('mainTitle', siteData.meta.title);
                setFieldValue('description', siteData.meta.description);
            }
            
            // Couple information
            updateCoupleFormFields();
            
            // Payment information
            if (siteData.payment) {
                setFieldValue('bankName', siteData.payment.bankName);
                setFieldValue('accountNumber', siteData.payment.accountNumber);
                setFieldValue('accountHolder', siteData.payment.accountHolder);
                setFieldValue('paymentMessage', siteData.payment.message);
            }
            
            // Event information
            if (siteData.event) {
                setFieldValue('ceremonyDate', siteData.event.ceremonyDate);
                setFieldValue('ceremonyTime', siteData.event.ceremonyTime);
                setFieldValue('ceremonyVenue', siteData.event.ceremonyVenue);
                setFieldValue('ceremonyAddress', siteData.event.ceremonyAddress);
                setFieldValue('receptionDate', siteData.event.weddingDate);
                setFieldValue('receptionTime', siteData.event.receptionTime);
                setFieldValue('receptionVenue', siteData.event.receptionVenue);
                setFieldValue('receptionAddress', siteData.event.receptionAddress);
            }
            
            console.log('✅ Form fields updated');
        }
        
        // Update couple form fields
        function updateCoupleFormFields() {
            console.log('🔄 Updating couple form fields...');
            console.log('📊 siteData.couple:', siteData.couple);
            
            if (siteData.couple) {
                console.log('👰 Groom data:', siteData.couple.groom);
                console.log('👰 Bride data:', siteData.couple.bride);
                console.log('👰 Parents data:', siteData.couple.parents);
                
                // Update groom info - handle both old and new data structure
                const groomName = siteData.couple.groom?.name || siteData.couple.groomName || '';
                const groomDescription = siteData.couple.groom?.description || siteData.couple.groomDescription || '';
                const groomFather = siteData.couple.parents?.groom?.father || siteData.couple.groomFather || '';
                const groomMother = siteData.couple.parents?.groom?.mother || siteData.couple.groomMother || '';
                
                setFieldValue('groomNameDetail', groomName);
                setFieldValue('groomDescription', groomDescription);
                setFieldValue('groomFather', groomFather);
                setFieldValue('groomMother', groomMother);
                
                // Update bride info - handle both old and new data structure
                const brideName = siteData.couple.bride?.name || siteData.couple.brideName || '';
                const brideDescription = siteData.couple.bride?.description || siteData.couple.brideDescription || '';
                const brideFather = siteData.couple.parents?.bride?.father || siteData.couple.brideFather || '';
                const brideMother = siteData.couple.parents?.bride?.mother || siteData.couple.brideMother || '';
                
                setFieldValue('brideNameDetail', brideName);
                setFieldValue('brideDescription', brideDescription);
                setFieldValue('brideFather', brideFather);
                setFieldValue('brideMother', brideMother);
                
                // Update images
                updateCoupleImages();
                
                console.log('✅ Couple form fields updated');
            } else {
                console.log('❌ No couple data found in siteData');
            }
        }
        
        // Update couple images
        function updateCoupleImages() {
            console.log('🔄 Updating couple images...');
            console.log('📊 siteData.couple:', siteData.couple);
            
            if (siteData.couple) {
                // Update groom image
                if (siteData.couple.groomImage) {
                    console.log('👰 Updating groom image:', siteData.couple.groomImage);
                    const groomImg = document.getElementById('groom-image-preview');
                    if (groomImg) {
                        // Convert relative path to absolute URL with cache busting
                        const groomSrc = siteData.couple.groomImage.replace('./public/', 'http://localhost:5001/public/');
                        const timestamp = new Date().getTime();
                        const groomSrcWithCache = `${groomSrc}?t=${timestamp}`;
                        console.log('👰 Groom image src:', groomSrcWithCache);
                        groomImg.src = groomSrcWithCache;
                        groomImg.style.display = 'block';
                        // Hide placeholder
                        const groomPlaceholder = groomImg.parentElement.querySelector('.upload-placeholder');
                        if (groomPlaceholder) {
                            groomPlaceholder.style.display = 'none';
                        }
                        console.log('✅ Groom image updated');
                    } else {
                        console.log('❌ Groom image element not found');
                    }
                } else {
                    console.log('❌ No groom image in siteData');
                }
                
                // Update bride image
                if (siteData.couple.brideImage) {
                    console.log('👰 Updating bride image:', siteData.couple.brideImage);
                    const brideImg = document.getElementById('bride-image-preview');
                    if (brideImg) {
                        // Convert relative path to absolute URL with cache busting
                        const brideSrc = siteData.couple.brideImage.replace('./public/', 'http://localhost:5001/public/');
                        const timestamp = new Date().getTime();
                        const brideSrcWithCache = `${brideSrc}?t=${timestamp}`;
                        console.log('👰 Bride image src:', brideSrcWithCache);
                        brideImg.src = brideSrcWithCache;
                        brideImg.style.display = 'block';
                        // Hide placeholder
                        const bridePlaceholder = brideImg.parentElement.querySelector('.upload-placeholder');
                        if (bridePlaceholder) {
                            bridePlaceholder.style.display = 'none';
                        }
                        console.log('✅ Bride image updated');
                    } else {
                        console.log('❌ Bride image element not found');
                    }
                } else {
                    console.log('❌ No bride image in siteData');
                }
            } else {
                console.log('❌ No couple data in siteData');
            }
        }
        
        // Set field value helper
        function setFieldValue(fieldId, value) {
            const field = document.getElementById(fieldId);
            console.log(`🔧 setFieldValue: ${fieldId} = ${value}, field found: ${!!field}`);
            
            if (field && value !== undefined) {
                if (field.type === 'checkbox') {
                    field.checked = !!value;
                    console.log(`✅ Checkbox ${fieldId} set to: ${field.checked}`);
                } else {
                    field.value = value;
                    console.log(`✅ Field ${fieldId} set to: ${field.value}`);
                }
            } else {
                if (!field) {
                    console.log(`❌ Field ${fieldId} not found in DOM`);
                }
                if (value === undefined) {
                    console.log(`❌ Value for ${fieldId} is undefined`);
                }
            }
        }
        
        // Save data to SQLite
        async function saveSiteData() {
            console.log('💾 Saving data to SQLite...');
            
            try {
                // Collect all form data
                const formData = {
                    hero: {
                        groomName: document.getElementById('groomName')?.value || '',
                        brideName: document.getElementById('brideName')?.value || '',
                        weddingDate: document.getElementById('weddingDate')?.value || '',
                        weddingLocation: document.getElementById('weddingLocation')?.value || ''
                    },
                    meta: {
                        title: document.getElementById('mainTitle')?.value || '',
                        description: document.getElementById('description')?.value || ''
                    },
                    payment: {
                        bankName: document.getElementById('bankName')?.value || '',
                        accountNumber: document.getElementById('accountNumber')?.value || '',
                        accountHolder: document.getElementById('accountHolder')?.value || '',
                        message: document.getElementById('paymentMessage')?.value || ''
                    },
                    couple: {
                        groom: {
                            name: document.getElementById('groomNameDetail')?.value || '',
                            description: document.getElementById('groomDescription')?.value || ''
                        },
                        bride: {
                            name: document.getElementById('brideNameDetail')?.value || '',
                            description: document.getElementById('brideDescription')?.value || ''
                        },
                        parents: {
                            groom: {
                                father: document.getElementById('groomFather')?.value || '',
                                mother: document.getElementById('groomMother')?.value || ''
                            },
                            bride: {
                                father: document.getElementById('brideFather')?.value || '',
                                mother: document.getElementById('brideMother')?.value || ''
                            }
                        },
                        groomImage: (siteData.couple && siteData.couple.groomImage) || '',
                        brideImage: (siteData.couple && siteData.couple.brideImage) || '',
                        visible: true
                    },
                    event: {
                        ceremonyDate: document.getElementById('ceremonyDate')?.value || '',
                        ceremonyTime: document.getElementById('ceremonyTime')?.value || '',
                        ceremonyVenue: document.getElementById('ceremonyVenue')?.value || '',
                        ceremonyAddress: document.getElementById('ceremonyAddress')?.value || '',
                        weddingDate: document.getElementById('receptionDate')?.value || '',
                        receptionTime: document.getElementById('receptionTime')?.value || '',
                        receptionVenue: document.getElementById('receptionVenue')?.value || '',
                        receptionAddress: document.getElementById('receptionAddress')?.value || ''
                    }
                };
                
                console.log('📦 Form data collected:', formData);
                console.log('📦 Couple data specifically:', formData.couple);
                
                // Send to SQLite API
                const response = await fetch('http://localhost:5001/api/data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('✅ Save result:', result);
                
                if (result.success) {
                    console.log('✅ Data saved successfully to SQLite');
                    Swal.fire({
                        icon: 'success',
                        title: 'Lưu thành công!',
                        text: '✅ Dữ liệu đã được lưu thành công vào SQLite!'
                    }).then(() => {
                        // Reload data after saving
                        loadSiteData();
                    });
                } else {
                    console.error('❌ Save failed:', result.message);
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi lưu dữ liệu',
                        text: '❌ Lỗi khi lưu dữ liệu: ' + result.message
                    });
                }
                
            } catch (error) {
                console.error('❌ Error saving data:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi lưu dữ liệu',
                    text: '❌ Lỗi khi lưu dữ liệu: ' + error.message
                });
            }
        }
        
        // Select couple image function
        function selectCoupleImage(type) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = false;
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (file) {
                    await uploadCoupleImage(file, type);
                }
            };
            input.click();
        }
        
        // Upload couple image function
        async function uploadCoupleImage(file, type) {
            console.log(`📸 Uploading ${type} image:`, file.name);
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('type', type);
                
                const response = await fetch('http://localhost:5001/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    const filename = result.data ? result.data.filename : result.filename;
                    
                    // Update siteData with new image
                    if (!siteData.couple) {
                        siteData.couple = {};
                    }
                    
                    if (type === 'groom') {
                        siteData.couple.groomImage = `./public/images/couple/${filename}`;
                        // Show image immediately with cache busting
                        const groomImg = document.getElementById('groom-image-preview');
                        if (groomImg) {
                            // Add timestamp to prevent browser cache
                            const timestamp = new Date().getTime();
                            groomImg.src = `http://localhost:5001/public/images/couple/${filename}?t=${timestamp}`;
                            groomImg.style.display = 'block';
                            const groomPlaceholder = groomImg.parentElement.querySelector('.upload-placeholder');
                            if (groomPlaceholder) {
                                groomPlaceholder.style.display = 'none';
                            }
                            console.log('🖼️ Updated groom image src:', groomImg.src);
                        }
                    } else if (type === 'bride') {
                        siteData.couple.brideImage = `./public/images/couple/${filename}`;
                        // Show image immediately with cache busting
                        const brideImg = document.getElementById('bride-image-preview');
                        if (brideImg) {
                            // Add timestamp to prevent browser cache
                            const timestamp = new Date().getTime();
                            brideImg.src = `http://localhost:5001/public/images/couple/${filename}?t=${timestamp}`;
                            brideImg.style.display = 'block';
                            const bridePlaceholder = brideImg.parentElement.querySelector('.upload-placeholder');
                            if (bridePlaceholder) {
                                bridePlaceholder.style.display = 'none';
                            }
                            console.log('🖼️ Updated bride image src:', brideImg.src);
                        }
                    }
                    
                    // Save to database immediately after upload
                    await saveSiteData();
                    
                    // Force reload the image after a short delay to ensure it's updated
                    setTimeout(() => {
                        if (type === 'groom') {
                            const groomImg = document.getElementById('groom-image-preview');
                            if (groomImg) {
                                const timestamp = new Date().getTime();
                                groomImg.src = `http://localhost:5001/public/images/couple/${filename}?t=${timestamp}`;
                                console.log('🔄 Force reloaded groom image:', groomImg.src);
                            }
                        } else if (type === 'bride') {
                            const brideImg = document.getElementById('bride-image-preview');
                            if (brideImg) {
                                const timestamp = new Date().getTime();
                                brideImg.src = `http://localhost:5001/public/images/couple/${filename}?t=${timestamp}`;
                                console.log('🔄 Force reloaded bride image:', brideImg.src);
                            }
                        }
                    }, 500);
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Upload thành công!',
                        text: `✅ Ảnh ${type === 'groom' ? 'chú rể' : 'cô dâu'} đã được upload và lưu thành công!`
                    });
                    
                    console.log(`✅ ${type} image uploaded and saved:`, filename);
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi upload ảnh',
                        text: `❌ Lỗi khi upload ảnh ${type}: ` + result.message
                    });
                }
            } catch (error) {
                console.error(`❌ Error uploading ${type} image:`, error);
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi upload ảnh',
                    text: `❌ Lỗi khi upload ảnh ${type}: ` + error.message
                });
            }
        }
        
        // Upload banner image function
        async function uploadBannerImage(file) {
            console.log('📸 Uploading banner image:', file.name);
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('type', 'banner');
                
                const response = await fetch('http://localhost:5001/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('✅ Banner upload result:', result);
                
                if (result.success) {
                    // Add banner to database
                    const filename = result.data ? result.data.filename : result.filename;
                    await addBannerToDatabase(filename);
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Upload thành công!',
                        text: '✅ Ảnh banner đã được upload và lưu vào database!'
                    });
                    
                    // Reload banner data
                    loadBannerData();
                    return filename;
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi upload ảnh',
                        text: '❌ Lỗi khi upload ảnh banner: ' + result.message
                    });
                    return null;
                }
                
            } catch (error) {
                console.error('❌ Error uploading banner image:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi upload ảnh',
                    text: '❌ Lỗi khi upload ảnh banner: ' + error.message
                });
                return null;
            }
        }
        
        // Add banner to database
        async function addBannerToDatabase(filename) {
            try {
                const bannerData = {
                    id: `banner-${Date.now()}`,
                    src: `./public/images/banner/${filename}`,
                    visible: true,
                    title: `Banner ${Date.now()}`,
                    description: 'Ảnh banner mới'
                };
                
                // Get current data
                const response = await fetch('http://localhost:5001/api/data');
                const result = await response.json();
                
                if (result.success && result.data) {
                    const currentData = result.data;
                    
                    // Add banner to hero slides
                    if (!currentData.hero) {
                        currentData.hero = {};
                    }
                    if (!currentData.hero.slides) {
                        currentData.hero.slides = [];
                    }
                    
                    currentData.hero.slides.push(bannerData);
                    
                    // Save updated data
                    const saveResponse = await fetch('http://localhost:5001/api/data', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(currentData)
                    });
                    
                    const saveResult = await saveResponse.json();
                    console.log('✅ Banner added to database:', saveResult);
                }
            } catch (error) {
                console.error('❌ Error adding banner to database:', error);
            }
        }
        
        // Load banner data from database
        async function loadBannerData() {
            console.log('🔄 Loading banner data from database...');
            
            try {
                const response = await fetch('http://localhost:5001/api/data');
                const result = await response.json();
                
                if (result.success && result.data && result.data.hero && result.data.hero.slides) {
                    const bannerSlides = result.data.hero.slides;
                    console.log('📦 Banner slides loaded:', bannerSlides);
                    
                    // Store slides globally for selectBanner function
                    window.currentBannerSlides = bannerSlides;
                    
                    // Display banner slides
                    displayBannerSlides(bannerSlides);
                    
                    // Update preview with current form data
                    updateBannerPreview(bannerSlides);
                } else {
                    console.log('❌ No banner data found');
                    document.getElementById('bannerSlidesList').innerHTML = '<p class="text-muted">Chưa có ảnh banner nào</p>';
                }
            } catch (error) {
                console.error('❌ Error loading banner data:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi tải dữ liệu',
                    text: '❌ Lỗi khi tải dữ liệu banner: ' + error.message
                });
            }
        }
        
        // Refresh preview with current form data
        function refreshPreview() {
            const slides = window.currentBannerSlides || [];
            if (slides.length > 0) {
                updateBannerPreview(slides);
                Swal.fire({
                    icon: 'success',
                    title: 'Đã làm mới preview',
                    text: 'Preview đã được cập nhật với thông tin mới nhất'
                });
            } else {
                Swal.fire({
                    icon: 'info',
                    title: 'Chưa có banner',
                    text: 'Vui lòng thêm banner trước khi xem preview'
                });
            }
        }
        
        // Display banner slides
        function displayBannerSlides(slides) {
            const container = document.getElementById('bannerSlidesList');
            
            if (!slides || slides.length === 0) {
                container.innerHTML = '<p class="text-muted">Chưa có ảnh banner nào</p>';
                return;
            }
            
            let html = '<div class="row">';
            slides.forEach((slide, index) => {
                html += `
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="position-relative">
                                <img src="${slide.src}" class="card-img-top" style="width: 100%; height: 200px; object-fit: contain; background-color: #f8f9fa;" alt="${slide.title}" onclick="changeBannerImage('${slide.id}')">
                                <div class="position-absolute top-0 end-0 m-2">
                                    <span class="badge bg-primary">${index + 1}</span>
                                </div>
                                <div class="position-absolute top-0 start-0 m-2">
                                    <button class="btn btn-sm btn-outline-light" onclick="changeBannerImage('${slide.id}')" title="Thay đổi ảnh">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <h6 class="card-title">${slide.title}</h6>
                                <p class="card-text small">${slide.description}</p>
                                <div class="btn-group w-100">
                                    <button class="btn btn-outline-primary btn-sm" onclick="editBannerSlide('${slide.id}')">
                                        <i class="fas fa-edit me-1"></i>Chỉnh sửa
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="deleteBannerSlide('${slide.id}')">
                                        <i class="fas fa-trash me-1"></i>Xóa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        // Professional banner preview with slideshow
        function updateBannerPreview(slides) {
            const preview = document.getElementById('bannerPreview');
            
            if (!slides || slides.length === 0) {
                preview.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-images"></i>
                        </div>
                        <h4>Chưa có banner nào</h4>
                        <p>Thêm banner đầu tiên để bắt đầu tạo slideshow</p>
                        <button class="btn btn-primary" onclick="addBannerSlide()">
                            <i class="fas fa-plus me-2"></i>Thêm banner đầu tiên
                        </button>
                    </div>
                `;
                return;
            }
            
            // Get wedding info from form or database
            const groomName = document.getElementById('groom-name')?.value || 'Huy Hùng';
            const brideName = document.getElementById('bride-name')?.value || 'Ngọc Trâm';
            const weddingDate = document.getElementById('invitation_date')?.value || '31 tháng 12 2025';
            
            let html = `
                <div class="preview-container">
                    <!-- Main Preview Area with Slideshow -->
                    <div class="preview-main">
                        <div class="preview-slideshow">
                            <div class="preview-slides">
                                ${slides.map((slide, index) => `
                                    <div class="preview-slide ${index === 0 ? 'active' : ''}" style="background-image: url('${slide.src}')">
                                        <div class="preview-overlay">
                                            <div class="preview-content">
                                                <h2 class="preview-title">Save the Date</h2>
                                                <h1 class="preview-names">${groomName} & ${brideName}</h1>
                                                <p class="preview-date">${weddingDate}</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="preview-badge">
                                <span class="badge">Preview</span>
                            </div>
                            <div class="preview-controls">
                                <button class="preview-control-btn" onclick="pausePreviewSlideshow()">
                                    <i class="fas fa-pause"></i>
                                </button>
                                <button class="preview-control-btn" onclick="resumePreviewSlideshow()">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Banner Info -->
                    <div class="preview-info">
                        <div class="info-card">
                            <div class="info-header">
                                <h5><i class="fas fa-info-circle me-2"></i>Thông tin banner</h5>
                            </div>
                            <div class="info-content">
                                <div class="info-item">
                                    <label>Tên chú rể:</label>
                                    <span>${groomName}</span>
                                </div>
                                <div class="info-item">
                                    <label>Tên cô dâu:</label>
                                    <span>${brideName}</span>
                                </div>
                                <div class="info-item">
                                    <label>Ngày cưới:</label>
                                    <span>${weddingDate}</span>
                                </div>
                                <div class="info-item">
                                    <label>Tổng số:</label>
                                    <span class="badge bg-primary">${slides.length} banner</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Thumbnail Gallery -->
                    <div class="preview-gallery">
                        <div class="gallery-header">
                            <h5><i class="fas fa-th me-2"></i>Thư viện banner</h5>
                            <span class="gallery-count">${slides.length} ảnh</span>
                        </div>
                        <div class="gallery-grid">
                            ${slides.map((slide, index) => `
                                <div class="gallery-item ${index === 0 ? 'active' : ''}" onclick="selectBanner(${index})">
                                    <div class="gallery-image">
                                        <img src="${slide.src}" alt="${slide.title}">
                                        <div class="gallery-overlay">
                                            <span class="gallery-number">${index + 1}</span>
                                        </div>
                                    </div>
                                    <div class="gallery-info">
                                        <span class="gallery-title">${slide.title}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            preview.innerHTML = html;
            
            // Initialize slideshow
            initializePreviewSlideshow(slides.length);
        }
        
        // Slideshow variables
        let previewSlideshowInterval = null;
        let previewCurrentSlide = 0;
        let previewTotalSlides = 0;
        let previewSlideshowPaused = false;
        
        // Initialize preview slideshow
        function initializePreviewSlideshow(slideCount) {
            previewTotalSlides = slideCount;
            previewCurrentSlide = 0;
            
            // Clear existing interval
            if (previewSlideshowInterval) {
                clearInterval(previewSlideshowInterval);
            }
            
            // Start slideshow
            if (slideCount > 1) {
                previewSlideshowInterval = setInterval(() => {
                    if (!previewSlideshowPaused) {
                        nextPreviewSlide();
                    }
                }, 5000); // Change slide every 5 seconds
            }
            
            console.log(`🎬 Preview slideshow initialized with ${slideCount} slides`);
        }
        
        // Next preview slide
        function nextPreviewSlide() {
            if (previewTotalSlides <= 1) return;
            
            previewCurrentSlide = (previewCurrentSlide + 1) % previewTotalSlides;
            showPreviewSlide(previewCurrentSlide);
        }
        
        // Show specific preview slide
        function showPreviewSlide(index) {
            const slides = document.querySelectorAll('.preview-slide');
            const galleryItems = document.querySelectorAll('.gallery-item');
            
            slides.forEach((slide, i) => {
                if (i === index) {
                    slide.classList.add('active');
                } else {
                    slide.classList.remove('active');
                }
            });
            
            galleryItems.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            previewCurrentSlide = index;
        }
        
        // Pause preview slideshow
        function pausePreviewSlideshow() {
            previewSlideshowPaused = true;
            console.log('⏸️ Preview slideshow paused');
        }
        
        // Resume preview slideshow
        function resumePreviewSlideshow() {
            previewSlideshowPaused = false;
            console.log('▶️ Preview slideshow resumed');
        }
        
        // Select banner function
        function selectBanner(index) {
            const slides = window.currentBannerSlides || [];
            if (slides[index]) {
                // Show specific slide
                showPreviewSlide(index);
                
                console.log(`Selected banner ${index + 1}: ${slides[index].title}`);
            }
        }
        
        
        // Banner management functions
        
        // Change banner image
        function changeBannerImage(slideId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = false;
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (file) {
                    try {
                        // Upload new image
                        const formData = new FormData();
                        formData.append('file', file);
                        formData.append('type', 'banner');
                        
                        const response = await fetch('http://localhost:5001/api/upload', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            // Update banner in database
                            const filename = result.data ? result.data.filename : result.filename;
                            await updateBannerImage(slideId, filename);
                            
                            Swal.fire({
                                icon: 'success',
                                title: 'Thay đổi thành công!',
                                text: '✅ Ảnh banner đã được thay đổi thành công!'
                            });
                            
                            // Reload banner data
                            loadBannerData();
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Lỗi upload ảnh',
                                text: '❌ Lỗi khi upload ảnh banner: ' + result.message
                            });
                        }
                    } catch (error) {
                        console.error('❌ Error changing banner image:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi thay đổi ảnh',
                            text: '❌ Lỗi khi thay đổi ảnh banner: ' + error.message
                        });
                    }
                }
            };
            input.click();
        }
        
        // Update banner image in database
        async function updateBannerImage(slideId, filename) {
            try {
                // Get current data
                const response = await fetch('http://localhost:5001/api/data');
                const result = await response.json();
                
                if (result.success && result.data) {
                    const currentData = result.data;
                    
                    // Update banner image
                    if (currentData.hero && currentData.hero.slides) {
                        const slideIndex = currentData.hero.slides.findIndex(slide => slide.id === slideId);
                        if (slideIndex !== -1) {
                            const oldSlide = currentData.hero.slides[slideIndex];
                            const oldFilePath = oldSlide.src;
                            
                            // Update with new image
                            currentData.hero.slides[slideIndex].src = `./public/images/banner/${filename}`;
                            
                            // Delete old file if it exists and is not the same as new file
                            if (oldFilePath && oldFilePath !== `./public/images/banner/${filename}`) {
                                try {
                                    await fetch('http://localhost:5001/api/delete-file', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            file_path: oldFilePath
                                        })
                                    });
                                    console.log('🗑️ Old file deleted:', oldFilePath);
                                } catch (deleteError) {
                                    console.warn('⚠️ Could not delete old file:', deleteError);
                                }
                            }
                        }
                    }
                    
                    // Save updated data
                    const saveResponse = await fetch('http://localhost:5001/api/data', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(currentData)
                    });
                    
                    const saveResult = await saveResponse.json();
                    console.log('✅ Banner image updated:', saveResult);
                }
            } catch (error) {
                console.error('❌ Error updating banner image:', error);
            }
        }
        
        function editBannerSlide(slideId) {
            Swal.fire({
                icon: 'info',
                title: 'Chỉnh sửa banner',
                text: 'Chức năng chỉnh sửa banner sẽ được phát triển trong phiên bản tiếp theo.'
            });
        }
        
        async function deleteBannerSlide(slideId) {
            const result = await Swal.fire({
                title: 'Xác nhận xóa',
                text: 'Bạn có chắc chắn muốn xóa ảnh banner này?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Xóa',
                cancelButtonText: 'Hủy'
            });
            
            if (result.isConfirmed) {
                try {
                    // Get current data
                    const response = await fetch('http://localhost:5001/api/data');
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        const currentData = result.data;
                        
                        // Remove banner from slides and delete file
                        if (currentData.hero && currentData.hero.slides) {
                            const slideToDelete = currentData.hero.slides.find(slide => slide.id === slideId);
                            if (slideToDelete && slideToDelete.src) {
                                // Delete file from server
                                try {
                                    await fetch('http://localhost:5001/api/delete-file', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            file_path: slideToDelete.src
                                        })
                                    });
                                    console.log('🗑️ Banner file deleted:', slideToDelete.src);
                                } catch (deleteError) {
                                    console.warn('⚠️ Could not delete banner file:', deleteError);
                                }
                            }
                            
                            // Remove from slides array
                            currentData.hero.slides = currentData.hero.slides.filter(slide => slide.id !== slideId);
                        }
                        
                        // Save updated data
                        const saveResponse = await fetch('http://localhost:5001/api/data', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(currentData)
                        });
                        
                        const saveResult = await saveResponse.json();
                        
                        if (saveResult.success) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Xóa thành công!',
                                text: '✅ Ảnh banner đã được xóa khỏi database!'
                            });
                            
                            // Reload banner data
                            loadBannerData();
                        }
                    }
                } catch (error) {
                    console.error('❌ Error deleting banner:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi xóa banner',
                        text: '❌ Lỗi khi xóa ảnh banner: ' + error.message
                    });
                }
            }
        }
        
        function reloadBannerData() {
            loadBannerData();
        }
        
        function clearBannerSlides() {
            Swal.fire({
                icon: 'warning',
                title: 'Xác nhận xóa tất cả',
                text: 'Bạn có chắc chắn muốn xóa tất cả ảnh banner?',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Xóa tất cả',
                cancelButtonText: 'Hủy'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        // Get current data
                        const response = await fetch('http://localhost:5001/api/data');
                        const result = await response.json();
                        
                        if (result.success && result.data) {
                            const currentData = result.data;
                            
                            // Clear banner slides
                            if (currentData.hero) {
                                currentData.hero.slides = [];
                            }
                            
                            // Save updated data
                            const saveResponse = await fetch('http://localhost:5001/api/data', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(currentData)
                            });
                            
                            const saveResult = await saveResponse.json();
                            
                            if (saveResult.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Xóa thành công!',
                                    text: '✅ Tất cả ảnh banner đã được xóa!'
                                });
                                
                                // Reload banner data
                                loadBannerData();
                            }
                        }
                    } catch (error) {
                        console.error('❌ Error clearing banners:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi xóa banner',
                            text: '❌ Lỗi khi xóa tất cả ảnh banner: ' + error.message
                        });
                    }
                }
            });
        }
        
        function addBannerSlide() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.multiple = false;
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (file) {
                    try {
                        // Upload new image
                        const formData = new FormData();
                        formData.append('file', file);
                        formData.append('type', 'banner');
                        
                        const response = await fetch('http://localhost:5001/api/upload', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            // Add banner to database
                            const filename = result.data ? result.data.filename : result.filename;
                            await addBannerToDatabase(filename);
                            
                            Swal.fire({
                                icon: 'success',
                                title: 'Thêm banner thành công!',
                                text: '✅ Ảnh banner đã được thêm thành công!'
                            });
                            
                            // Reload banner data
                            loadBannerData();
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Lỗi upload ảnh',
                                text: '❌ Lỗi khi upload ảnh banner: ' + result.message
                            });
                        }
                    } catch (error) {
                        console.error('❌ Error uploading banner image:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi upload ảnh',
                            text: '❌ Lỗi khi upload ảnh banner: ' + error.message
                        });
                    }
                }
            };
            input.click();
        }
        
        function refreshBannerPreview() {
            loadBannerData();
        }
        
        // Additional functions for compatibility
        function downloadData() {
            console.log('📥 Download data function called');
            Swal.fire({
                icon: 'info',
                title: 'Thông báo',
                text: 'Chức năng tải file JSON đã được thay thế bằng SQLite. Dữ liệu đã được lưu trong database.'
            });
        }
        
        function loadData() {
            console.log('📤 Load data function called');
            Swal.fire({
                icon: 'info',
                title: 'Thông báo',
                text: 'Chức năng nhập file JSON đã được thay thế bằng SQLite. Dữ liệu được load từ database.'
            }).then(() => {
                loadSiteData();
            });
        }
        
        function previewWebsite() {
            console.log('👁️ Preview website function called');
            window.open('http://localhost:5001/', '_blank');
        }
        
        function loadDataFromIndex() {
            console.log('🔄 Load data from index function called');
            loadSiteData();
        }
        
        // Initialize admin when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM Content Loaded, initializing admin...');
            
            // Load data from SQLite
            loadSiteData();
            
            // Load banner data
            loadBannerData();
            
            // Add save button event listeners
            const saveButtons = document.querySelectorAll('button[type="submit"], .btn-save, .btn-primary');
            saveButtons.forEach(button => {
                if (button.textContent.includes('Lưu') || button.textContent.includes('Save')) {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('💾 Save button clicked:', button.textContent);
                        saveSiteData();
                    });
                }
            });
            
            // Add image upload event listeners
            const imageInputs = document.querySelectorAll('input[type="file"]');
            imageInputs.forEach(input => {
                input.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const type = input.getAttribute('data-type') || 'general';
                        uploadImage(file, type);
                    }
                });
            });
        });
    </script>
    
    <!-- Story Management Script -->
    <script src="admin/js/story-management.js?v=1759556253"></script>
</body>
</html>
